{% extends "base.html" %}
{% block title %}AI Assistant{% endblock %}
{% block page_title %}ðŸ§  AI Assistant{% endblock %}

{% block content %}
<div class="chat-layout">

     <!-- â”€â”€ Chat Panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
     <div class="card chat-panel" style="padding:0;overflow:hidden">
          <!-- Messages -->
          <div class="chat-messages" id="chatMessages">
               <!-- Welcome message -->
               <div class="msg ai fade-up">
                    <div class="msg-avatar">ðŸ¤–</div>
                    <div>
                         <div class="msg-bubble">
                              ðŸ‘‹ Hello! I'm <strong>DefectAI Assistant</strong>.<br><br>
                              I have real-time access to your inspection data. Ask me anything about defects, pass
                              rates, or model performance!
                         </div>
                         <div class="msg-time">Just now</div>
                    </div>
               </div>
          </div>

          <!-- Quick Actions -->
          <div class="chat-input-area">
               <div class="quick-actions" id="quickActions">
                    <button class="quick-action-btn" onclick="sendQuickMsg('Show last 5 defects')">Last 5
                         defects</button>
                    <button class="quick-action-btn" onclick="sendQuickMsg('What is today\'s pass rate?')">Pass
                         rate</button>
                    <button class="quick-action-btn" onclick="sendQuickMsg('Which defect type is most common?')">Common
                         defects</button>
                    <button class="quick-action-btn" onclick="sendQuickMsg('How confident is the model?')">Model
                         confidence</button>
                    <button class="quick-action-btn"
                         onclick="sendQuickMsg('Explain the latest inspection result')">Latest result</button>
                    <button class="quick-action-btn" onclick="sendQuickMsg('System health check')">Health check</button>
               </div>
               <div class="chat-input-row">
                    <textarea class="chat-input" id="chatInput"
                         placeholder="Ask about defects, pass rates, model confidenceâ€¦" rows="1"
                         onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();sendMessage()}"></textarea>
                    <button class="chat-send-btn" onclick="sendMessage()">âžœ</button>
               </div>
          </div>
     </div>

     <!-- â”€â”€ AI Insights Panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
     <div class="insights-panel">
          <div class="card" style="padding:1rem">
               <div class="card-title" style="margin-bottom:0.75rem">âš¡ Live Insights</div>
               <div style="display:flex;flex-direction:column;gap:0.6rem">
                    <div class="insight-card">
                         <div class="insight-label">Last Inspection</div>
                         <div class="insight-value" id="insLastResult">â€”</div>
                         <div class="insight-sub" id="insLastTime">No data yet</div>
                    </div>
                    <div class="insight-card">
                         <div class="insight-label">Highest Confidence</div>
                         <div class="insight-value" id="insHighConf">â€”</div>
                         <div class="insight-sub" id="insHighConfFile">â€”</div>
                    </div>
                    <div class="insight-card">
                         <div class="insight-label">Most Common Defect</div>
                         <div class="insight-value" id="insMostCommon">â€”</div>
                         <div class="insight-sub" id="insMostCommonCount">No defects recorded</div>
                    </div>
                    <div class="insight-card">
                         <div class="insight-label">Recommended Action</div>
                         <div class="insight-value" id="insAction" style="font-size:0.88rem;color:var(--cyan)">
                              Awaiting first inspection
                         </div>
                    </div>
                    <div class="insight-card">
                         <div class="insight-label">Session Pass Rate</div>
                         <div class="insight-value" id="insPassRate">â€”</div>
                         <div class="insight-sub" id="insPassRateSub">â€”</div>
                    </div>
               </div>
          </div>

          <div class="card" style="padding:1rem">
               <div class="card-title" style="margin-bottom:0.75rem">ðŸ§¬ Model Info</div>
               <div id="modelInfoList">
                    <div class="sysinfo-row"><span class="sysinfo-key">YOLOv8</span><span class="sysinfo-val"
                              id="miYolo">â€”</span></div>
                    <div class="sysinfo-row"><span class="sysinfo-key">CNN+LSTM</span><span class="sysinfo-val"
                              id="miCnn">â€”</span></div>
                    <div class="sysinfo-row"><span class="sysinfo-key">Anomaly</span><span class="sysinfo-val"
                              id="miAnomaly">â€”</span></div>
                    <div class="sysinfo-row"><span class="sysinfo-key">Classes</span><span class="sysinfo-val">2
                              (GOOD/DEFECTIVE)</span></div>
                    <div class="sysinfo-row"><span class="sysinfo-key">Pipeline</span><span class="sysinfo-val"
                              style="color:var(--green)">Active</span></div>
               </div>
          </div>
     </div>

</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/assistant.js') }}"></script>
{% endblock %}